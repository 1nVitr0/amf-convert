<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="/js/lib/util/typedarray.js"></script>
    <script src="/js/build/amf.js"></script>

    <script type="text/javascript">
        (function() {
            var results = [];
            var callback = function(xhr) {
                if(xhr.readyState == 4) {
                    results.push(AMF.deserialize(xhr.responseText));
                }
            };

            for(var test in tests) {
                var test = tests[test];

                var forceType = test.length > 2 ? test[2] : undefined;
                var serialized = AMF.serialize(test[1], true, forceType);

                sendAMFData('/php/server.php', serialized, callback);
            }

            tape('Integration tests', function(t) {
                t.plan(tests.length);

                for(var i in tests) {
                    var test = tests[i];
                    var result = results[i];

                    // *null* and *circular* are expected to fail
                    try {
                        t.same(result, test[1]);
                    } catch(e) {
                        t.fail(e.message);
                    }
                }
            });
        })();
    </script>
</head>
<body>
</body>
</html>